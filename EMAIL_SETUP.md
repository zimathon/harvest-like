# メール送信機能のセットアップガイド

## 概要
このアプリケーションはNodemailerとGmailを使用して、コストをかけずにメール送信機能を実装しています。

## Gmail設定手順

### 1. Googleアカウントの2段階認証を有効化
1. [Googleアカウント設定](https://myaccount.google.com/security)にアクセス
2. 「2段階認証プロセス」をクリック
3. 指示に従って2段階認証を設定

### 2. アプリパスワードの生成
1. [アプリパスワード設定ページ](https://myaccount.google.com/apppasswords)にアクセス
2. 「アプリ」で「メール」を選択
3. 「デバイス」で「その他（カスタム名）」を選択
4. 「Harvest-like」など識別しやすい名前を入力
5. 「生成」をクリック
6. 表示された16文字のパスワードをコピー（スペースは不要）

### 3. 環境変数の設定

`server/.env`ファイルを作成し、以下を設定：

```env
# メール設定
EMAIL_USER=your_email@gmail.com
EMAIL_PASS=生成したアプリパスワード（16文字）
EMAIL_FROM=Harvest-like <your_email@gmail.com>
```

## 開発環境での動作

開発環境（`NODE_ENV`が`production`以外）では：
- 実際のメールは送信されません
- コンソールにメール内容が表示されます
- テスト時に便利です

## 本番環境での動作

本番環境（`NODE_ENV=production`）では：
- 実際にメールが送信されます
- 1日あたり500通まで無料で送信可能
- それ以上必要な場合はSendGridなどの有料サービスを検討

## 送信されるメールの種類

### 1. 招待メール
- 新しいチームメンバーを招待した時
- 仮パスワードとログイン手順を含む
- HTMLとテキストの両方のフォーマット

### 2. パスワードリセットメール（将来実装予定）
- パスワードを忘れた時
- リセットリンクを含む
- 1時間の有効期限付き

## トラブルシューティング

### メールが送信されない場合

1. **2段階認証が有効になっているか確認**
   - Googleアカウント設定で確認

2. **アプリパスワードが正しいか確認**
   - 16文字のパスワード（スペースなし）
   - 通常のGoogleパスワードではない

3. **環境変数が設定されているか確認**
   ```bash
   echo $EMAIL_USER
   echo $EMAIL_PASS
   ```

4. **Googleアカウントのセキュリティ設定を確認**
   - [安全性の低いアプリのアクセス](https://myaccount.google.com/lesssecureapps)は不要（アプリパスワード使用時）

### エラーメッセージ別の対処法

- `Invalid login`: アプリパスワードが間違っている
- `Username and Password not accepted`: 2段階認証が無効、または通常のパスワードを使用している
- `Quota exceeded`: 1日の送信制限（500通）を超えた

## セキュリティ上の注意

1. **環境変数ファイルをGitにコミットしない**
   - `.env`ファイルは`.gitignore`に含まれています

2. **アプリパスワードを他人と共有しない**
   - 各開発者が自分のGmailアカウントを使用

3. **本番環境では専用のメールアカウントを使用**
   - noreply@yourdomain.comなど

## 代替オプション

将来的により多くのメール送信が必要になった場合：

1. **SendGrid**
   - 月100通まで無料
   - APIベースで高速

2. **Amazon SES**
   - 従量課金制
   - 大量送信に適している

3. **Mailgun**
   - 月1,000通まで無料（3ヶ月間）
   - 開発者向け機能が充実