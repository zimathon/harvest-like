# GCP Cost Estimation for Harvest Like Application

## 概要
本ドキュメントでは、Harvest Likeアプリケーションの GCP デプロイに関する想定コストを詳細に分析します。
※ 価格は2025年1月時点のアジア東北1リージョン（東京）の料金に基づいています。

## 月額コスト見積もり

### 総額サマリー
| 環境 | 最小構成 | 標準構成 | 高負荷時 |
|------|----------|----------|----------|
| **月額合計** | **¥3,500〜5,000** | **¥8,000〜12,000** | **¥20,000〜30,000** |

## 詳細コスト内訳

### 1. Cloud Run (バックエンド API)
```yaml
設定:
- メモリ: 512 Mi
- CPU: 1 vCPU
- 最小インスタンス: 1 (本番)、0 (ステージング)
- 最大インスタンス: 10
- タイムアウト: 60秒
```

**料金計算:**
- **CPU時間**: $0.00002400/vCPU秒 × 1 vCPU
- **メモリ**: $0.00000250/GiB秒 × 0.5 GiB
- **リクエスト**: $0.40/100万リクエスト

**月額見積もり:**
| 負荷レベル | アクティブ時間 | リクエスト数 | 月額コスト |
|------------|----------------|--------------|------------|
| 最小（開発） | 100時間 | 10万 | ¥800 |
| 標準（小規模） | 730時間（常時1台） | 100万 | ¥3,500 |
| 高負荷（中規模） | 1,460時間（平均2台） | 500万 | ¥7,500 |

### 2. Firestore (データベース)
```yaml
設定:
- ネイティブモード
- マルチリージョン: asia-northeast1
- 自動バックアップ: 有効
```

**料金計算:**
- **ストレージ**: $0.108/GB/月
- **読み取り**: $0.038/10万ドキュメント
- **書き込み**: $0.115/10万ドキュメント
- **削除**: $0.013/10万ドキュメント

**月額見積もり:**
| 使用規模 | ストレージ | 読み書き回数 | 月額コスト |
|----------|------------|--------------|------------|
| 最小 | 1 GB | 10万/日 | ¥500 |
| 標準 | 10 GB | 100万/日 | ¥2,000 |
| 大規模 | 100 GB | 1000万/日 | ¥8,000 |

### 3. Cloud Storage (フロントエンド静的ファイル)
```yaml
設定:
- Standard ストレージクラス
- リージョン: asia-northeast1
- パブリックアクセス
```

**料金計算:**
- **ストレージ**: $0.023/GB/月
- **ネットワーク転送**: $0.12/GB（アジア内）
- **オペレーション**: $0.005/1万オペレーション

**月額見積もり:**
| トラフィック | ストレージ | 転送量 | 月額コスト |
|--------------|------------|---------|------------|
| 低 | 100 MB | 10 GB | ¥150 |
| 中 | 500 MB | 100 GB | ¥1,500 |
| 高 | 1 GB | 500 GB | ¥6,500 |

### 4. Cloud Load Balancing & CDN
```yaml
設定:
- HTTP(S) ロードバランサー
- Cloud CDN 有効
- SSL証明書（マネージド）
```

**料金計算:**
- **ロードバランサー**: $0.025/時間 + $0.008/GB
- **Cloud CDN キャッシュ**: $0.02〜0.04/GB
- **SSL証明書**: 無料（マネージド）

**月額見積もり:**
| 使用量 | CDNキャッシュヒット率 | 月額コスト |
|--------|----------------------|------------|
| 低 | 80% | ¥2,000 |
| 中 | 85% | ¥3,000 |
| 高 | 90% | ¥5,000 |

### 5. Artifact Registry
```yaml
設定:
- Dockerイメージストレージ
- リージョン: asia-northeast1
```

**料金計算:**
- **ストレージ**: $0.10/GB/月
- **ネットワーク転送**: Cloud Run内は無料

**月額見積もり:**
- イメージサイズ: 約200MB × 10バージョン = 2GB
- **月額**: ¥25

### 6. Secret Manager
```yaml
設定:
- シークレット数: 5個程度
- アクセス頻度: 低
```

**料金計算:**
- **ストレージ**: $0.06/シークレット/月
- **アクセス**: $0.03/1万アクセス

**月額見積もり:** ¥50

### 7. Cloud Monitoring & Logging
```yaml
設定:
- 基本的なメトリクス収集
- ログ保持期間: 30日
```

**料金計算:**
- **最初の50GB**: 無料
- **追加ログ**: $0.50/GB

**月額見積もり:**
| ログ量 | 月額コスト |
|--------|------------|
| 〜50GB | 無料 |
| 100GB | ¥3,000 |
| 500GB | ¥25,000 |

## 使用パターン別の月額見積もり

### 1. 開発・テスト環境
```
想定:
- ユーザー数: 〜10人
- リクエスト: 10万/月
- データ量: 1GB

月額合計: ¥2,000〜3,000
内訳:
- Cloud Run: ¥800
- Firestore: ¥500
- Storage & CDN: ¥500
- その他: ¥200
```

### 2. 小規模本番環境（スタートアップ）
```
想定:
- ユーザー数: 100〜500人
- リクエスト: 100万/月
- データ量: 10GB

月額合計: ¥8,000〜12,000
内訳:
- Cloud Run: ¥3,500
- Firestore: ¥2,000
- Storage & CDN: ¥2,000
- Load Balancer: ¥2,000
- その他: ¥500
```

### 3. 中規模本番環境
```
想定:
- ユーザー数: 1,000〜5,000人
- リクエスト: 500万/月
- データ量: 50GB

月額合計: ¥20,000〜30,000
内訳:
- Cloud Run: ¥7,500
- Firestore: ¥5,000
- Storage & CDN: ¥4,000
- Load Balancer: ¥3,000
- Monitoring: ¥500
```

### 4. 大規模本番環境
```
想定:
- ユーザー数: 10,000人以上
- リクエスト: 1,000万/月
- データ量: 100GB以上

月額合計: ¥50,000〜100,000
内訳:
- Cloud Run: ¥15,000
- Firestore: ¥10,000
- Storage & CDN: ¥8,000
- Load Balancer: ¥5,000
- Monitoring: ¥2,000
- その他: ¥10,000
```

## コスト最適化のヒント

### 1. Cloud Run の最適化
- **最小インスタンス数を0に設定**: 開発環境では常時起動を避ける
- **コールドスタート対策**: Cloud Scheduler で定期的にping
- **適切なメモリサイズ**: 256MBから始めて必要に応じて増やす

### 2. Firestore の最適化
- **複合インデックスの最小化**: 必要なものだけ作成
- **バッチ処理の活用**: 書き込みをまとめて実行
- **キャッシュの活用**: 頻繁に読むデータはキャッシュ

### 3. Storage & CDN の最適化
- **適切なキャッシュヘッダー**: 静的アセットは長期キャッシュ
- **画像の最適化**: WebP形式の使用、適切なサイズ
- **Lifecycle ポリシー**: 古いバックアップの自動削除

### 4. 監視とアラート
```yaml
推奨アラート設定:
- Cloud Run CPU使用率 > 80%
- Firestore 読み取り > 100万/日
- 月額コスト > 予算の80%
```

## 無料枠の活用

GCPの無料枠（月額）:
- Cloud Run: 200万リクエスト、36万GB秒のメモリ、18万vCPU秒
- Firestore: 1GB ストレージ、5万読み取り、2万書き込み
- Cloud Storage: 5GB ストレージ、1GB ネットワーク転送
- Secret Manager: 6個のシークレット、1万アクセス

## 年間契約割引

### Committed Use Discounts (CUD)
- 1年契約: 約20%割引
- 3年契約: 約40%割引

### 推奨事項
- 本番環境が安定したらCUDの検討
- 予測可能なワークロードにのみ適用

## コスト管理のベストプラクティス

### 1. 予算アラートの設定
```bash
gcloud billing budgets create \
  --billing-account=BILLING_ACCOUNT_ID \
  --display-name="Harvest Production Budget" \
  --budget-amount=30000 \
  --threshold-rule=percent=50 \
  --threshold-rule=percent=90 \
  --threshold-rule=percent=100
```

### 2. コストレポートの自動化
- BigQuery へのエクスポート設定
- Data Studio でのダッシュボード作成
- 週次/月次レポートの自動送信

### 3. タグ付けによるコスト配分
```yaml
labels:
  environment: production
  team: development
  project: harvest-like
  cost-center: engineering
```

## まとめ

### 初期導入時（最初の3ヶ月）
- **推奨構成**: 小規模本番環境
- **月額予算**: ¥10,000
- **主な用途**: 開発、テスト、初期ユーザー獲得

### 成長期（3〜12ヶ月）
- **推奨構成**: 中規模本番環境
- **月額予算**: ¥30,000
- **主な用途**: ユーザー拡大、機能追加

### 安定期（12ヶ月以降）
- **推奨構成**: 最適化された中〜大規模環境
- **月額予算**: ¥50,000〜
- **主な用途**: スケール対応、SLA保証

## 注意事項
- 価格は2025年1月時点のもので、変更される可能性があります
- 実際のコストは使用パターンにより大きく変動します
- 初月は無料枠が適用されるため、実際のコストは低くなります
- サポートプラン（月額$29〜）は含まれていません